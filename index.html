 <!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Soumettre un acteur OCOI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 20px auto; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, textarea, select { width:100%; padding:6px; }
    button { margin-top:15px; padding:8px 16px; background:#003366; color:#fff; border:none; cursor:pointer; }
    .msg { margin-top:15px; background:#eef; padding:8px 10px; border-radius:6px; display:none; }
  </style>
</head>
<body>
  <h1>Soumettre un acteur</h1>
  <p>Merci de renseigner les informations de l'organisation.</p>

  <form id="acteur-form">
    <label>Nom de l’acteur</label>
    <input type="text" name="nom" required>

    <label>Site web</label>
    <input type="url" name="site">

    <label>Adresse / Région</label>
    <input type="text" name="adresse">

    <label>Email</label>
    <input type="email" name="mail">

    <label>Téléphone</label>
    <input type="text" name="tel">

    <label>Texte 1 (description courte)</label>
    <textarea name="texte1" rows="2"></textarea>

    <label>Texte 2 (description détaillée)</label>
    <textarea name="texte2" rows="4"></textarea>

    <button type="submit">Envoyer</button>
  </form>

  <div class="msg" id="msg">
    Données générées. Un fichier <b>data.json</b> a été créé, tu peux le télécharger puis le déposer dans ton dépôt GitHub.
  </div>

  <script>
    // on part de la structure que tu as dans data.json
    const baseData = {
      "acteurs": [
        {
          "nom": "Exemple Société",
          "site": "https://exemple.com",
          "adresse": "La Réunion",
          "mail": "contact@exemple.com",
          "tel": "+262 262 00 00 00",
          "texte1": "Prestataire IT spécialisé en sécurité et réseau.",
          "texte2": "Entreprise réunionnaise fournissant des services informatiques aux entreprises locales et régionales, avec une expertise en infrastructure, cybersécurité et cloud."
        }
      ]
    };

    const form = document.getElementById('acteur-form');
    const msg = document.getElementById('msg');

    form.addEventListener('submit', function(e) {
      e.preventDefault(); // on évite le rechargement de page

      // on récupère les valeurs du formulaire
      const formData = new FormData(form);
      const newActor = {
        nom: formData.get('nom'),
        site: formData.get('site'),
        adresse: formData.get('adresse'),
        mail: formData.get('mail'),
        tel: formData.get('tel'),
        texte1: formData.get('texte1'),
        texte2: formData.get('texte2')
      };

      // on ajoute au tableau existant
      const updatedData = JSON.parse(JSON.stringify(baseData)); // copie propre
      updatedData.acteurs.push(newActor);

      // on crée un blob pour télécharger le nouveau JSON
       fetch("http://192.168.1.38:5000/submit", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(newActor)
})
.then(r => r.json())
.then(res => {
  if (res.status === "ok") {
    msg.innerHTML = "Acteur ajouté avec succès sur le backend OCOI.";
  } else {
    msg.innerHTML = "Erreur : " + res.msg;
  }
  msg.style.display = "block";
  form.reset();
})
.catch(() => {
  msg.innerHTML = "Erreur de connexion au backend.";
  msg.style.display = "block";
});
